/*! vy 2015-09-02 */
(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o=function(a,b){return function(){return a.apply(b,arguments)}},p=function(a,b){function c(){this.constructor=a}for(var d in b)q.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},q={}.hasOwnProperty;m=function(a,b){var c,d;for(d in b)c=b[d],a[d]=c;return a},l=function(a){var b;return b=document.createElement("div"),b.innerHTML=a,b.childNodes[0]},n=function(a){var b;return b=a.getBoundingClientRect(),{top:b.top+window.pageYOffset,left:b.left+window.pageXOffset}},this.Vy=function(){function a(a,b){var c;null==b&&(b={}),this.hook=o(this.hook,this),c={buttons:{left:["rewind"],right:["sound"]}},c=m(c,b),this.View=new k(a,c),this.Events=new d(this,this.View),this.hook(this.View.component("root"))}return a.prototype.hook=function(a){return a.vy=this},a.prototype.elapsedPercent=function(){return this.elapsedSeconds()/player.duration},a.prototype.elapsedSeconds=function(){return this.View.component("player").currentTime},a.prototype.jumpToPercent=function(a){var b;return b=this.View.component("player"),this.jumpToSecond(a*b.duration)},a.prototype.jumpToSecond=function(a){return this.View.component("player").currentTime=a},a.prototype.rewind=function(){return this.jumpToSecond(0)},a.prototype.getSeekPercent=function(a){var b;return b=this.View.component("player"),(a-n(b).left)/b.offsetWidth},a.prototype.play=function(){return this.View.component("player").play()},a.prototype.pause=function(){return this.View.component("player").pause()},a.prototype.mute=function(){return this.View.component("player").setAttribute("muted","muted"),this.root.setAttribute("muted","muted")},a.prototype.unmute=function(){return this.View.component("player").removeAttribute("muted"),this.root.removeAttribute("muted")},a.prototype.setAsPlaying=function(){return this.View.root.setAttribute("playing","playing")},a.prototype.setAsPaused=function(){return this.View.root.removeAttribute("playing")},a.prototype.isMuted=function(){return!!this.View.component("player").getAttribute("muted")},a.prototype.isPlaying=function(){var a;return"playing"===(null!=(a=this.View.root)?a.getAttribute("playing"):void 0)},a.prototype.toggleMute=function(){return this.isMuted()?this.unmute():this.mute()},a}(),window.addEventListener("load",function(a){var b,c,d,e,f,g;for(d=document.querySelectorAll(".vy-video"),e=[],b=0,c=d.length;c>b;b++)g=d[b],f=JSON.parse(g.getAttribute("data-vy-settings")),e.push(g.vy=new Vy(g,f));return e}),"undefined"!=typeof $&&null!==$&&($.fn.vy=function(a){return null==a&&(a={}),this.each(function(b,c){return null==c.vy&&(c.vy=new Vy(c,a)),c})}),b=function(){function a(a){this.root=this.build(a)}return a.prototype.toString=function(){return this.root.toString()},a}(),a=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return p(b,a),b.prototype.build=function(a){return"<div class='vy-buttons vy-buttons-"+a+"'></div>"},b}(b),c=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return p(b,a),b.prototype.build=function(){return"<div class='vy-controls'></div>"},b}(b),e=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return p(b,a),b.prototype.build=function(){return"<div class='vy-pause'></div>"},b}(b),f=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return p(b,a),b.prototype.build=function(){return"<div class='vy-placeholder'></div>"},b}(b),g=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return p(b,a),b.prototype.build=function(){return"<div class='vy-play'></div>"},b}(b),h=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return p(b,a),b.prototype.build=function(){return"<div class='vy-positioner'></div>"},b}(b),i=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return p(b,a),b.prototype.build=function(a){return"<div class='vy-"+a+"-slider'></div>"},b.prototype.moveToPercent=function(a){return a>=1&&(a=1),this.root.style.right=100-100*a+"%"},b}(b),j=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return p(b,a),b.prototype.build=function(){return"<div class='vy-title'></div>"},b.prototype.set=function(a){return this.title=a,this.root.textContent=a},b}(b),d=function(){function a(a,b){this.View=b,this.Vy=a,this.init()}var b;return b={MouseDownOnVideo:!1,MovingSlider:!1},a.prototype.trigger=function(a){return this.View.component("player").dispatchEvent(new Event(a))},a.prototype.init=function(){return this.View.component("root").addEventListener("mouseleave",function(a){return function(a){return b.MovingSlider=!1,b.MouseDownOnVideo=!1}}(this)),this.View.component("play").addEventListener("click",function(a){return function(b){return b.preventDefault(),a.Vy.play()}}(this)),this.View.component("pause").addEventListener("click",function(c){return function(d){return d.preventDefault(),a.MovingSlider?(c.Vy.jumpToPercent(c.Vy.getSeekPercent(d.clientX)),c.Vy.play()):c.Vy.pause(),b.MovingSlider=!1,b.MouseDownOnVideo=!1}}(this)),this.View.component("pause").addEventListener("mousedown",function(a){return function(a){return a.preventDefault(),b.MouseDownOnVideo=!0}}(this)),this.View.component("pause").addEventListener("mousemove",function(a){return function(c){var d;return c.preventDefault(),b.MouseDownOnVideo?(b.MovingSlider=!0,d=a.Vy.getSeekPercent(c.clientX),a.Vy.jumpToPercent(d),a.Vy.movePlaySliderToPercent(d)):void 0}}(this)),this.View.component("player").addEventListener("progress",function(a){return function(b){var c,d;return c=null!=(d=a.buffered)?d.end(0):void 0,c!==a.duration?a.Vy.moveLoadSliderToPercent(c):void 0}}(this)),this.View.component("rewind").addEventListener("click",function(a){return function(b){return b.stopPropagation(),a.Vy.rewind()}}(this)),this.View.component("sound").addEventListener("click",function(a){return function(b){return b.stopPropagation(),a.Vy.toggleMute()}}(this)),this.View.component("player").addEventListener("play",function(a){return function(b){return a.Vy.setAsPlaying()}}(this)),this.View.component("player").addEventListener("pause",function(a){return function(b){return a.Vy.setAsPaused()}}(this)),this.View.component("player").addEventListener("currenttimeupdate",function(a){return function(b){return a.Vy.movePlaySliderToPercent(a.Vy.elapsedPercent())}}(this)),setInterval(function(a){return function(){return a.Vy.isPlaying()?a.trigger("currenttimeupdate"):void 0}}(this),20)},a}(),k=function(){function b(a,b){this.componentCache={},console.log(this.buildComponentTree())}var d,k;return k="<div class='vy'> <div class='vy-title'></div> <div class='vy-positioner'> <video class='vy-placeholder'></video> </div> <div class='vy-controls'> <div class='vy-play'></div> <div class='vy-pause'></div> <div class='vy-buttons vy-buttons-left'></div> <div class='vy-buttons vy-buttons-right'></div <div class='vy-play-slider'></div> <div class='vy-load-slider'></div> </div> </div>",d='<div class="vy-button"></div>',b.prototype.buildComponentTree=function(){return[["title",new j,[["positioner",new h]]],["placeholder",new f],["controls",new c],["play",new g],["pause",new e],["buttonsLeft",new a("left")],["buttonsRight",new a("right")],["playSlider",new i("play")],["loadSlider",new i("load")]],[{title:new j,children:{positioner:new h,children:{placeholder:new f}}}]},b.prototype.buildPlayer=function(a,b){var c,d,e;return d=a.cloneNode(!0),d.classList.add("vy-player"),e=l(k,!0),c=e.querySelector("video.vy-placeholder"),c.parentNode.replaceChild(d,c),a.parentNode.replaceChild(e,a),e},b.prototype.insertButtons=function(a){var b,c,e,f,g,h,i,j,k;for(e=l(d),i=Object.keys(a),j=[],g=0,h=i.length;h>g;g++)f=i[g],k=this.component("buttons-"+f),"right"===f&&a[f].reverse(),j.push(function(){var d,g,h,i;for(h=a[f],i=[],d=0,g=h.length;g>d;d++)b=h[d],c=e.cloneNode(!0),c.classList.add("vy-"+b),c.textContent=b,i.push(k.appendChild(c));return i}());return j},b.prototype.insertTitle=function(a){return(null!=a?a.length:void 0)?this.component("title").textContent=a:void 0},b.prototype.component=function(a,b){var c;return null==b&&(b=!0),a in this.componentCache?this.componentCache[a]:(c="root"===a?this.root:this.root.querySelector(".vy-"+a),this.componentCache[a]=c)},b}()}).call(this);